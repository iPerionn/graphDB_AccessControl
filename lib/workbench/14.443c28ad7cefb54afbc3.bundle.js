(window.webpackJsonp=window.webpackJsonp||[]).push([[14,60,96,244,252],{101:function(e,t,s){"use strict";s.r(t),s.d(t,"ACListModel",(function(){return r})),s.d(t,"ACRuleModel",(function(){return i})),s.d(t,"StatementACRuleModel",(function(){return n})),s.d(t,"PluginACRuleModel",(function(){return l})),s.d(t,"ClearGraphACRuleModel",(function(){return a})),s.d(t,"SystemACRuleModel",(function(){return c})),s.d(t,"ACL_POLICY",(function(){return d})),s.d(t,"ACL_OPERATION",(function(){return p})),s.d(t,"ACL_SCOPE",(function(){return h})),s.d(t,"DEFAULT_CONTEXT_VALUES",(function(){return g})),s.d(t,"DEFAULT_CLEAR_GRAPH_CONTEXT_VALUES",(function(){return R})),s.d(t,"DEFAULT_URI_VALUES",(function(){return _}));var o=s(27);class r{constructor(e=[]){this._aclRules=new Map,e.forEach(e=>{const t=e.scope;this._aclRules.has(t)||this._aclRules.set(t,[]),this._aclRules.get(t).push(e)})}size(e){return this._aclRules.get(e)&&this._aclRules.get(e).length}appendNewRule(e,t,s,o,r,i,n,l,a){const c=u.createRule(e,t,s,o,r,i,n,l,a);this._aclRules.has(e)||this._aclRules.set(e,[]),c.checkCustomOrNegatedPrefix(),this._aclRules.get(e).push(c)}addRule(e,t){const s=this._aclRules.get(e);s?s.splice(t,0,u.createRule(e)):this._aclRules.set(e,[u.createRule(e)])}removeRule(e,t){const s=this._aclRules.get(e);s&&s.splice(t,1)}replaceRule(e,t,s){const o=this._aclRules.get(e);o&&o.splice(t,1,s)}getRule(e,t){const s=this._aclRules.get(e);return s?s[t]:null}isRuleDuplicated(e,t){const s=this.getRule(e,t);return!!s&&this._aclRules.get(e).some((e,r)=>r!==t&&Object(o.isEqual)(s,e))}setPrefixWarningFlag(e,t){const s=this.getRule(e,t);s&&s.checkCustomOrNegatedPrefix()}getRuleCopy(e,t){const s=this.getRule(e,t);return u.createRule(s.scope,s.policy,s.role,s.operation,s.subject,s.predicate,s.object,s.context,s.plugin)}moveUp(e,t){const s=this._aclRules.get(e),o=s[t-1];s[t-1]=s[t],s[t]=o}moveDown(e,t){const s=this._aclRules.get(e),o=s[t+1];s[t+1]=s[t],s[t]=o}toJSON(){const e=[];return this._aclRules.forEach(t=>{t.forEach(t=>e.push(t.toJSON()))}),e}get aclRules(){return this._aclRules}set aclRules(e){this._aclRules=e}getRulesByScope(e){return this._aclRules.get(e)||[]}getRuleKeysByScope(e){return Object.keys(this.getRulesByScope(e)[0]||{})}}class i{constructor(e,t,s=d.ALLOW){this._scope=e,this._role=t,this._policy=s}get scope(){return this._scope}set scope(e){this._scope=e}get roleWithoutCustomPrefix(){return this._role.startsWith("!")?this._role.replace("CUSTOM_","Â "):this._role.replace("CUSTOM_","")}get role(){return this._role}set role(e){this._role=e}get policy(){return this._policy}set policy(e){this._policy=e}get warnForPrefix(){return this._warnForPrefix}checkCustomOrNegatedPrefix(){this._warnForPrefix=this.role.startsWith("CUSTOM_CUSTOM_")||this.role.startsWith("!CUSTOM_CUSTOM_")}toJSON(){}}class n extends i{constructor(e,t,s,o,r,i,n){super(h.STATEMENT,e,t),this._subject=s||"*",this._predicate=o||"*",this._object=r||"*",this._context=i||"*",this._operation=n||p.ALL}get subject(){return this._subject}set subject(e){this._subject=e}get predicate(){return this._predicate}set predicate(e){this._predicate=e}get object(){return this._object}set object(e){this._object=e}get context(){return this._context}set context(e){this._context=e}get operation(){return this._operation}set operation(e){this._operation=e}toJSON(){return{scope:this.scope,policy:this.policy,role:this.role,operation:this.operation,subject:this.subject,predicate:this.predicate,object:this.object,context:this.context,warnForPrefix:this.warnForPrefix}}}class l extends i{constructor(e,t,s,o){super(h.PLUGIN,e,t),this._plugin=s||"*",this._operation=o||p.ALL}get plugin(){return this._plugin}set plugin(e){this._plugin=e}get operation(){return this._operation}set operation(e){this._operation=e}toJSON(){return{scope:this.scope,policy:this.policy,role:this.role,operation:this.operation,plugin:this.plugin,warnForPrefix:this.warnForPrefix}}}class a extends i{constructor(e,t,s,o){super(h.CLEAR_GRAPH,e,t),this._context=s||"*",this._defaultResults=o||["*","default","custom"]}get context(){return this._context}set context(e){this._context=e}get defaultResults(){return this._defaultResults}set defaultResults(e){this._defaultResults=e}toJSON(){return{scope:this.scope,policy:this.policy,role:this.role,context:this.context,warnForPrefix:this.warnForPrefix}}}class c extends i{constructor(e,t,s){super(h.SYSTEM,e,t),this._operation=s||p.ALL}get operation(){return this._operation}set operation(e){this._operation=e}toJSON(){return{scope:this.scope,policy:this.policy,role:this.role,operation:this.operation,warnForPrefix:this.warnForPrefix}}}class u{static createRule(e,t,s,o,r,i,u,d,p){switch(e){case h.STATEMENT:return new n(s,t,r,i,u,d,o);case h.PLUGIN:return new l(s,t,p,o);case h.CLEAR_GRAPH:return new a(s,t,d);case h.SYSTEM:return new c(s,t,o);default:throw new Error("Invalid scope: "+e+" provided")}}}const d={ALLOW:"allow",DENY:"deny"},p={READ:"read",WRITE:"write",ALL:"*"},h={STATEMENT:"statement",CLEAR_GRAPH:"clear_graph",PLUGIN:"plugin",SYSTEM:"system"},g=[{type:"default",value:"*",description:"acl_management.defaults.asterisk"},{type:"default",value:"default",description:"acl_management.defaults.default"},{type:"default",value:"named",description:"acl_management.defaults.named"}],R=[{type:"default",value:"*",description:"acl_management.defaults.asterisk"},{type:"default",value:"all",description:"acl_management.defaults.all"},{type:"default",value:"default",description:"acl_management.defaults.default"},{type:"default",value:"named",description:"acl_management.defaults.named"}],_=[{type:"default",value:"*",description:"acl_management.defaults.asterisk"}]},144:function(e,t){angular.module("graphdb.framework.rest.aclmanagement.service",[]).factory("AclManagementRestService",s),s.$inject=["$http"];function s(e){return{getAcl:function(t){return e.get(`rest/repositories/${t}/acl`)},updateAcl:function(t,s){return e.put(`rest/repositories/${t}/acl`,s)}}}},145:function(e,t,s){"use strict";s.r(t),s.d(t,"mapAclRulesResponse",(function(){return r}));var o=s(101);const r=e=>{const t=new o.ACListModel;return e&&e.data&&e.data.forEach(e=>{t.appendNewRule(e.scope,e.policy,e.role,e.operation,e.subject,e.predicate,e.object,e.context,e.plugin)}),t}},240:function(e,t,s){"use strict";s.r(t);s(37),s(144);var o=s(145),r=s(27),i=s(80),n=s(101);function l(e,t,s,l,a,c,u,d,p){e.contextValue=void 0;const h=[];e.ruleData={},e.loading=!1,e.namespaces=[],e.rulesModel=void 0,e.rulesModelCopy=void 0,e.selectedRule=void 0,e.editedRuleIndex=void 0,e.editedRuleScope=void 0,e.editedRuleCopy=void 0,e.isNewRule=!1,e.modelIsDirty=!1,e.dirtyScope=new Set,e.activeTabScope=n.ACL_SCOPE.STATEMENT,e.ACL_SCOPE=n.ACL_SCOPE,e.DEFAULT_CONTEXT_VALUES=n.DEFAULT_CONTEXT_VALUES,e.DEFAULT_CLEAR_GRAPH_CONTEXT_VALUES=n.DEFAULT_CLEAR_GRAPH_CONTEXT_VALUES,e.DEFAULT_URI_VALUES=n.DEFAULT_URI_VALUES,e.rowHeights={},e.hasCustomPrefix=!1,e.isEditMode=()=>void 0===e.editedRuleIndex&&e.rulesModel&&e.modelIsDirty&&e.dirtyScope.size>0,e.addRule=(t,s)=>{e.rulesModel.addRule(t,s),e.showPrefixWarningIcon(!1),e.editedRuleIndex=s,e.editedRuleScope=t,e.isNewRule=!0,f(t)},e.editRule=(t,s)=>{e.editedRuleIndex=s,e.editedRuleScope=t,e.isNewRule=!1,e.editedRuleCopy=e.rulesModel.getRuleCopy(t,s),e.rulesModel.setPrefixWarningFlag(t,s),e.getRowHeight="height: "+e.rowHeights[e.editedRuleIndex],f(t)},e.deleteRule=(t,s)=>{u.openConfirmation(c.instant("common.confirm"),c.instant("acl_management.rulestable.messages.delete_rule_confirmation",{index:s+1}),()=>{e.rulesModel.removeRule(t,s),f(t)})},e.saveRule=t=>{e.rulesModel.setPrefixWarningFlag(e.editedRuleScope,e.editedRuleIndex),e.rulesModel.isRuleDuplicated(e.editedRuleScope,e.editedRuleIndex)?S():(e.editedRuleIndex=void 0,e.editedRuleScope=void 0,e.isNewRule=!1,f(t))},e.cancelEditing=(t,s)=>{e.isNewRule?(e.rulesModel.removeRule(t,s),e.isNewRule=!1):(e.rulesModel.replaceRule(t,s,e.editedRuleCopy),e.editedRuleCopy=void 0),e.rulesModel.setPrefixWarningFlag(t,s),e.editedRuleIndex=void 0,e.editedRuleScope=void 0,f(t)},e.moveUp=(t,s)=>{e.rulesModel.moveUp(t,s),f(t),e.modelIsDirty?e.selectedRule=s-1:e.selectedRule=void 0},e.moveDown=(t,s)=>{e.rulesModel.moveDown(t,s),f(t),e.modelIsDirty?e.selectedRule=s+1:e.selectedRule=void 0},e.saveAcl=()=>{e.loading=!0,R().then(g).catch(e=>{const t=getError(e);s.error(t,c.instant("acl_management.errors.updating_rules"))}).finally(()=>{e.loading=!1})},e.cancelAclSave=()=>{u.openConfirmation(c.instant("common.confirm"),c.instant("acl_management.rulestable.messages.revert_acl_list"),()=>{_(),s.success(c.instant("acl_management.rulestable.messages.rules_reverted"))})},e.switchTab=(t,s)=>{void 0===e.editedRuleIndex?(e.selectedRule=void 0,e.activeTabScope=s,e.ruleKeys=e.rulesModel.getRuleKeysByScope(e.activeTabScope)):t.preventDefault()},e.setDirty=function(e){f(e)},e.showPrefixWarningIcon=function(t){e.hasCustomPrefix=t},e.performSearchActionOnEnter=function(t,s,o){13===t.keyCode&&(t.stopPropagation(),t.preventDefault(),e.triggerValidation(o),o.$valid&&e.saveRule(s))},e.triggerValidation=function(e){angular.forEach(e,(function(e){"object"==typeof e&&e.hasOwnProperty("$modelValue")&&e.$setTouched()}))};const g=()=>{const t=A();return l.getAcl(t).then(t=>{e.rulesModel=Object(o.mapAclRulesResponse)(t),e.rulesModelCopy=Object(o.mapAclRulesResponse)(t),m()}).catch(e=>{const t=getError(e);s.error(t,c.instant("acl_management.errors.loading_rules"))})},R=()=>{const t=A();return l.updateAcl(t,e.rulesModel.toJSON()).then(()=>{s.success(c.instant("acl_management.rulestable.messages.rules_updated"))})},_=()=>{A()&&(e.loading=!0,g().finally(()=>{e.loading=!1}))},m=()=>{e.selectedRule=void 0,e.editedRuleIndex=void 0,e.editedRuleScope=void 0,e.modelIsDirty=!1,e.editedRuleCopy=void 0,e.dirtyScope.clear()},f=t=>{!Object(r.isEqual)(e.rulesModel.getRulesByScope(t),e.rulesModelCopy.getRulesByScope(t))?e.dirtyScope.add(t):e.dirtyScope.delete(t),e.modelIsDirty=e.dirtyScope.size>0},A=()=>a.getActiveRepository(),S=()=>{s.error(c.instant("acl_management.errors.duplicated_rules"))},v=t=>{e.modelIsDirty&&(t.returnValue=!0)},y=()=>{window.removeEventListener("beforeunload",v),h.forEach(e=>e())},E=(s,o)=>{e.modelIsDirty&&(s.preventDefault(),u.openSimpleModal({title:c.instant("common.confirm"),message:c.instant("acl_management.rulestable.messages.unsaved_changes_confirmation"),warning:!0}).result.then((function(){y();const e=t.absUrl().length-t.url().length,s=o.substring(e);t.path(s)}),(function(){})))},x=()=>{e.getAutocompletePromise=p.checkAutocompleteStatus()};a.getActiveRepository()&&d.getNamespaces(a.getActiveRepository()).then(i.mapNamespacesResponse).then(t=>{e.namespaces=t}).catch(e=>{const t=getError(e);s.error(t,c.instant("error.getting.namespaces.for.repo"))}),h.push(e.$on("autocompleteStatus",x)),h.push(e.$watch(A,()=>{m(),_()})),h.push(e.$on("$locationChangeStart",E)),h.push(e.$on("$destroy",y)),window.addEventListener("beforeunload",v)}angular.module("graphdb.framework.aclmanagement.controllers",["graphdb.framework.rest.plugins.service","graphdb.framework.rest.aclmanagement.service"]).controller("AclManagementCtrl",l),l.$inject=["$scope","$location","toastr","AclManagementRestService","$repositories","$translate","ModalService","RDF4JRepositoriesRestService","AutocompleteRestService"]},80:function(e,t,s){"use strict";s.r(t),s.d(t,"mapNamespacesResponse",(function(){return o}));const o=e=>e&&e.data?e.data.results.bindings.map(e=>({prefix:e.prefix.value,uri:e.namespace.value})):[]}}]);