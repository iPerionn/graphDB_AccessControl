(window.webpackJsonp=window.webpackJsonp||[]).push([[68,106],{157:function(e,t,n){"use strict";n.r(t);n(10),n(158);var o=n(87),r=n(27),s=n(82);let a=240;const i={no_cluster_configured:"",create_cluster_btn:"",legend_node_state:"",legend_link_state:"",node_state_leader:"Leader",node_state_follower:"Follower",node_state_candidate:"Candidate",node_state_no_cluster:"No cluster",node_state_out_of_sync:"Out of sync",node_state_no_connection:"No connection",node_state_read_only:"Read only",node_state_restricted:"Restricted",link_state_in_sync:"In sync",link_state_syncing:"Syncing",link_state_out_of_sync:"Out of sync",recovery_state:{searching_for_node:"Searching for node",waiting_for_snapshot:"Waiting for snapshot from node",receiving_snapshot:"Receiving a snapshot from node",applying_snapshot:"Applying a snapshot",building_snapshot:"Building a snapshot for node",sending_snapshot:"Sending a snapshot to node",recovery_operation_failure_warning:"Node unable to recover. Action required"}},c={node_state:"legend_node_state",link_state:"legend_link_state"};angular.module("graphdb.framework.clustermanagement.directives.cluster-graphical-view",["graphdb.framework.utils.localstorageadapter","graphdb.framework.clustermanagement.directives.cluster-legend"]).directive("clusterGraphicalView",["$window","LocalStorageAdapter","LSKeys","UriUtils","$translate","$jwtAuth","$rootScope","ClusterViewContextService",function(e,t,n,d,l,u,_,f){return{restrict:"E",scope:{clusterModel:"="},link:function(p,g){const h=angular.element(e),E=[];let w,m,C,y,v,S=N(),k=O(),L=Math.min(S,k)/2-100,b=S/2,A=k/2;function M(){const e=f.getClusterViewD3Container();S=N(),k=O(),e.attr("width",S),e.attr("height",k),U()}function D(e,t=""){Object.keys(e).forEach(n=>{let o="";t&&(o+=t),o+="."+n;const r=e[n];"string"==typeof r?e[n]=l.instant("cluster_management.cluster_graphical_view"+o):"object"==typeof r&&D(r,o)})}function N(){const o="collapsedMenu"===t.get(n.MENU_STATE);return a=o?70:240,Math.max(Math.floor(.95*(e.innerWidth-a)),600)}function O(){return Math.max(.95*(e.innerHeight-250),675)}function T(){o.updateClusterZoneLabels(m,C,i),Object.keys(c).forEach(e=>{d3.select("#"+e).text(function(e){return i[c[e]]}(e))})}function R(){L=Math.min(S,k)/2-100,b=S/2,A=k/2,o.moveElement(C,b,A),C.select(".cluster-zone").attr("r",L)}function I(e){p.$emit(s.CLICK_IN_VIEW,e.target)}function U(){R(),m!==p.clusterModel.hasCluster&&(m=!!p.clusterModel.hasCluster,function(e){o.setCreateClusterZone(e,C,i,w),!e&&w&&C.on("mouseup",()=>{p.$emit(s.CREATE_CLUSTER)})}(m));const e=function(){const e=Object(r.cloneDeep)(p.clusterModel.nodes)||[];return e.forEach(e=>{if(e.hostname=d.shortenIri(e.endpoint),!Object(r.isEmpty)(e.recoveryStatus)){let t="cluster_management.cluster_graphical_view.recovery_state."+e.recoveryStatus.state.toLowerCase();e.recoveryStatus.affectedNodes&&e.recoveryStatus.affectedNodes.length>0&&(t+="_with_affected_node"),e.recoveryStatus.message=l.instant(t,{node:e.recoveryStatus.affectedNodes.join(", ")})}}),e}();!function(e){const t=y.selectAll("#node-group").data(e,e=>e.address),n=o.createNodes(t,45);n.on("click",(e,t)=>{p.$emit(s.NODE_SELECTED,t);const n=d3.select(".nodetooltip"),o=$(window).width();e.pageX<o/2?(n.style("left",e.pageX+"px"),n.style("right","")):(n.style("left",""),n.style("right",o-e.pageX+"px")),n.style("top",e.pageY-28+"px")}),o.updateNodes(n),o.positionNodesOnClusterZone(n,b,A,L)}(e);!function(e,t){const n=v.selectAll(".link").data(e,e=>e.id);o.createLinks(n),o.updateLinks(n,t)}(Object(r.cloneDeep)(p.clusterModel.links)||[],e)}p.width=function(){return S},p.height=function(){return k};p.$on("$destroy",(function(){h.unbind("resize",M),h.unbind("mousedown",I),o.removeEventListeners(),E.forEach(e=>e())})),w=u.isAdmin(),h.bind("resize",M),h.bind("mousedown",I),E.push(_.$on("$translateChangeSuccess",(function(){D(i),T()}))),E.push(p.$on(s.MODEL_UPDATED,(function(){U()}))),D(i),function(e){const t=o.createClusterSvgElement(g[0]).attr("width",S).attr("height",k);C=o.createClusterZone(t,e),v=t.append("g").attr("id","links-group"),y=t.append("g").attr("id","nodes-group"),o.addArrowHead(t,o.ARROW_CONFIG.BIG),o.addArrowHead(t,o.ARROW_CONFIG.SMALL),f.updateClusterViewD3Container(t)}(!(!p.clusterModel.nodes||!p.clusterModel.nodes.length)),U()}}}])},82:function(e,t,n){"use strict";n.r(t),n.d(t,"UPDATE_CLUSTER",(function(){return o})),n.d(t,"DELETE_CLUSTER",(function(){return r})),n.d(t,"CLICK_IN_VIEW",(function(){return s})),n.d(t,"NODE_SELECTED",(function(){return a})),n.d(t,"CREATE_CLUSTER",(function(){return i})),n.d(t,"MODEL_UPDATED",(function(){return c}));const o="updateCluster",r="deleteCluster",s="clickInView",a="nodeSelected",i="createCluster",c="modelUpdated"}}]);