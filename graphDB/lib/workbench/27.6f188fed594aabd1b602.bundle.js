(window.webpackJsonp=window.webpackJsonp||[]).push([[27,76,158,193,201,271],{181:function(e,r,t){"use strict";t.r(r);t(70),t(10);var s=t(69),a=t(67),i=t(14),n=t(76),o=t(91);function u(e,r,t,u,p,c,d,h,g,y,l,Q,f,m,w,I,R){let _;r.newConfig=new n.GraphsConfig,r.revertConfig=void 0,r.page=1,r.totalPages=5,r.helpHidden=1===m.get(w.HIDE_GRAPH_CONFIG_HELP),r.isUpdate=!1,r.shared=!1,r.canEditActiveRepo=r.canWriteActiveRepo(),r.samples=[],r.tabConfig={inference:r.newConfig.startQueryIncludeInferred,sameAs:r.newConfig.startQuerySameAs},r.getAutocompletePromise=void 0,r.getNamespacesPromise=void 0,r.tabsViewModel=[];const C=l.configName,S=c.getActiveRepository();r.toggleHelp=e=>{void 0===e&&(e=m.get(w.HIDE_GRAPH_CONFIG_HELP)),1!==e?(m.set(w.HIDE_GRAPH_CONFIG_HELP,1),r.helpHidden=!0):(m.set(w.HIDE_GRAPH_CONFIG_HELP,0),r.helpHidden=!1)},r.fixedVisualCallback=(e,t)=>{r.newConfig.startIRI=e,r.newConfig.startIRILabel=t,_=!0},r.isDefaultGraph=e=>e.isDefaultGraph(),r.isUserGraph=e=>!e.isDefaultGraph(),r.getSampleName=(e,r)=>{if(!e)return"";const t=e.getPropertyDescription(r);return t||(e.id?"Copy of "+e.name:e.name)},r.createGraphConfig=e=>{g.createGraphConfig(e).success((async function(){await Q.showToastMessageWithDelay("graphexplore.saved.new.config"),u.url("graphs-visualizations")})).error((function(e){p.error(getError(e),I.instant("graphexplore.error.could.not.create"))}))},r.updateGraphConfig=e=>{g.updateGraphConfig(e).success((async function(){await Q.showToastMessageWithDelay("graphexplore.saved.config"),u.url("graphs-visualizations")})).error((function(e){p.error(getError(e),I.instant("graphexplore.error.could.not.save"))}))},r.goToPage=e=>{r.page!==e&&G(()=>{r.showEditor(),r.page=e})},r.goToPreviousPage=()=>{r.page>1&&r.goToPage(r.page-1),N()&&(_=!1)},r.goToNextPage=()=>{q(),r.newConfig.isStartMode(n.StartMode.NODE)&&!_||r.goToPage(r.page+1)},r.saveGraphConfig=()=>{q(),N()&&!_||(r.newConfig.startQueryIncludeInferred=r.tabConfig.inference,r.newConfig.startQuerySameAs=r.tabConfig.sameAs,G(()=>{r.newConfig.name?(r.queryEditorIsDirty=!1,r.isUpdate?r.updateGraphConfig(r.newConfig.toSavePayload()):r.createGraphConfig(r.newConfig.toSavePayload())):x(I.instant("graphexplore.provide.config.name"))}))},r.setQuery=async e=>{const t=e||" ";(await E()).setQuery(t),r.markDirty()},r.markDirty=async()=>{if(r.revertConfig){const e=r.revertConfig.getQueryType(r.page),t=await M();r.queryEditorIsDirty=e!==t}},r.showEditor=()=>{r.viewMode="yasr",A(),v()},r.showPreview=()=>{r.viewMode="editor",D()},r.revertEditor=()=>{r.setQuery(r.revertConfig.getQueryType(r.page)),r.queryEditorIsDirty=!1};const E=()=>i.YasguiComponentDirectiveUtil.getOntotextYasguiElementAsync("#query-editor"),D=async(e,t)=>{const s=await E(),a=await s.getQueryType();if(t&&"SELECT"!==a&&"CONSTRUCT"!==a&&"DESCRIBE"!==a)return void p.warning(I.instant("query.editor.warning.msg"));"update"!==await s.getQueryMode()?r.queryIsRunning||(r.viewMode="editor",b()):p.warning(I.instant("cannot.execute.update.error"))},b=async()=>{(await E()).query(a.RenderingMode.YASR)},v=async()=>(await E()).changeRenderMode(a.RenderingMode.YASQE),M=async()=>(await E()).getQuery(),A=async()=>(await E()).abortQuery(),G=async e=>{const t=await(async()=>{const e=await E();let t=await e.getQuery();return t=t.trim(),r.newConfig.updateModel(t,r.page)})();1===r.page?t.isStartMode(n.StartMode.NODE)&&!t.startIRI?x(I.instant("graphexplore.select.start.node")):t.isStartMode(n.StartMode.QUERY)&&!t.startGraphQuery?x(I.instant("graphexplore.provide.query")):t.isStartMode(n.StartMode.QUERY)?T(e,t.startGraphQuery,"graph"):e():2===r.page?T(e,t.expandQuery,"construct",["node"]):3===r.page?T(e,t.resourceQuery,"tuple",["node"],[],["type","label","comment","rank"]):4===r.page?T(e,t.predicateLabelQuery,"tuple",["edge"],["label"]):5===r.page&&T(e,t.resourcePropertiesQuery,"tuple",["node"],["property","value"])},P=()=>{r.tabConfig.inference=r.newConfig.startQueryIncludeInferred,r.tabConfig.sameAs=r.newConfig.startQuerySameAs,r.setQuery(r.newConfig.getQueryType(r.page))},x=e=>{p.warning(e)},L=()=>{r.getAutocompletePromise=y.checkAutocompleteStatus()},T=(e,r,t,s,a,i)=>{r?g.validateQuery(r,t,s,a,i).success(()=>{e()}).error(e=>{x(getError(e))}):e()},q=()=>{N()&&r.$broadcast("addStartFixedNodeAutomatically",{startIRI:r.newConfig.startIRI})},N=()=>1===r.page&&r.newConfig.isStartMode(n.StartMode.NODE),$=()=>{g.getGraphConfigSamples().success((function(e){r.samples=Object(o.mapGraphConfigSamplesToGraphConfigs)(e).filter(e=>!e.id||r.newConfig.id!==e.id||(r.revertConfig=e,!1))})).error((function(e){p.error(getError(e),I.instant("graphexplore.error.graph.configs"))})),L(),r.getNamespacesPromise=f.getNamespaces(r.getActiveRepository())},Y={endpoint:()=>"repositories/"+c.getActiveRepository(),showEditorTabs:!1,showToolbar:!1,showResultTabs:!1,showYasqeActionButtons:!1,yasqeActionButtons:i.INFERRED_AND_SAME_AS_BUTTONS_CONFIGURATION,showQueryButton:!1,initialQuery:" ",componentId:"graphs-config",render:a.RenderingMode.YASQE,maxPersistentResponseSize:0,showYasqeResizer:!1,yasqeMode:s.YasqeMode.PROTECTED,infer:r.newConfig.startQueryIncludeInferred,sameAs:r.newConfig.startQuerySameAs},O=(e,t,s)=>{r.queryIsRunning=e},U=()=>{window.removeEventListener("beforeunload",H),F.forEach(e=>e())},H=e=>{r.queryEditorIsDirty&&(e.returnValue=!0)},k=()=>{r.tabsViewModel=[{page:1,label:I.instant("starting.point.label"),type:"startGraphQuery"},{page:2,label:I.instant("graph.expansion"),type:"expandQuery"},{page:3,label:I.instant("node.basics"),type:"resourceQuery"},{page:4,label:I.instant("edge.basics"),type:"predicateLabelQuery"},{page:5,label:I.instant("node.extra"),type:"resourcePropertiesQuery"}]},F=[];F.push(r.$on("autocompleteStatus",L)),F.push(r.$on("$locationChangeStart",(e,t)=>{if(r.queryEditorIsDirty){e.preventDefault();((e,r,t,s)=>{R.openSimpleModal({title:e,message:r,warning:!0}).result.then((function(){angular.isFunction(t)&&t()}),(function(){angular.isFunction(s)&&s()}))})(I.instant("common.confirm"),I.instant("visual.config.warning.unsaved.changes"),()=>{U();const e=u.absUrl().length-u.url().length,r=t.substring(e);u.path(r)})}else U()})),F.push(r.$on("$destroy",U)),F.push(r.$watch(r.getActiveRepositoryObject,()=>{(r.newConfig.isStartMode(n.StartMode.QUERY)||r.page>1)&&(r.viewMode="yasr",A().then(v))})),F.push(e.$on("$translateChangeSuccess",()=>{k()})),window.addEventListener("beforeunload",H),r.$watch("newConfig.startMode",e=>{e===n.StartMode.QUERY&&P()}),r.$watch("page",e=>{(r.newConfig.isStartMode(n.StartMode.QUERY)||e>1)&&(r.showEditor(),P())}),k(),c.getPrefixes(S).then(e=>(e=>{const t=r.$watch((function(){return r.getActiveRepositoryObject()}),(function(a){if(a){r.canEditActiveRepo=r.canWriteActiveRepo();const a=angular.extend({},Y,{prefixes:e,yasqeMode:r.canWriteActiveRepo()?s.YasqeMode.WRITE:s.YasqeMode.PROTECTED});r.yasguiConfig=a,t()}}))})(e)).finally(()=>O(!1)),C?(r.isUpdate=!0,g.getConfig(C).then((function(e){r.newConfig=e,$()})).catch(e=>{p.error(getError(e),I.instant("created.connector",{name:C}))})):(r.isUpdate=!1,$()),r.getActiveRepository()&&(O(!0,I.instant("common.refreshing.namespaces"),I.instant("common.extra.message")),c.getPrefixes(c.getActiveRepository()).then(e=>{r.namespaces=e}).catch((function(e){r.repositoryError=getError(e)})).finally((function(){O(!1)})))}angular.module("graphdb.framework.graphexplore.controllers.graphviz.config",["graphdb.framework.utils.notifications","graphdb.framework.utils.localstorageadapter"]).controller("GraphConfigCtrl",u),u.$inject=["$rootScope","$scope","$timeout","$location","toastr","$repositories","SparqlRestService","$filter","GraphConfigRestService","AutocompleteRestService","$routeParams","Notifications","RDF4JRepositoriesRestService","LocalStorageAdapter","LSKeys","$translate","ModalService"]},67:function(e,r,t){"use strict";t.r(r),t.d(r,"RenderingMode",(function(){return s}));const s={YASGUI:"mode-yasgui",YASQE:"mode-yasqe",YASR:"mode-yasr"}},69:function(e,r,t){"use strict";t.r(r),t.d(r,"YasqeMode",(function(){return s}));const s={WRITE:"WRITE",READ:"READ",PROTECTED:"PROTECTED"}},70:function(e,r){function t(e,r){return{showToastMessageWithDelay:function(t){return new Promise(s=>{e.success(r.instant(t)),setTimeout(s,200)})}}}angular.module("graphdb.framework.utils.notifications",[]).factory("Notifications",t),t.$inject=["toastr","$translate"]},76:function(e,r,t){"use strict";t.r(r),t.d(r,"StartMode",(function(){return s})),t.d(r,"GraphsConfig",(function(){return a}));const s={QUERY:"query",NODE:"node",SEARCH:"search"};class a{constructor(e,r,t=s.SEARCH,a,i=!0,n=!0,o,u,p,c,d,h,g,y,l,Q,f,m,w,I,R){this._id=e,this._name=r,this._startMode=t,this._owner=a,this._startQueryIncludeInferred=i,this._startQuerySameAs=n,this._startGraphQuery=o,this._startIRI=u,this._startIRILabel=p,this._expandQuery=c,this._resourceQuery=d,this._predicateLabelQuery=h,this._resourcePropertiesQuery=g,this._shared=y,this._description=l,this._hint=Q,this._startGraphQueryDescription=f,this._expandQueryDescription=m,this._resourceQueryDescription=w,this._predicateLabelQueryDescription=I,this._resourcePropertiesQueryDescription=R}isStartMode(e){return this.startMode===e}isDefaultGraph(){return"Minimal"===this.name||"Advanced"===this.name}getPropertyDescription(e){return this[e+"Description"]}getQueryType(e){let r;return this.isStartMode(s.QUERY)&&1===e?r=this.startGraphQuery:2===e?r=this.expandQuery:3===e?r=this.resourceQuery:4===e?r=this.predicateLabelQuery:5===e&&(r=this.resourcePropertiesQuery),r||""}updateModel(e,r){return this.isStartMode(s.QUERY)&&1===r?this.startGraphQuery=e:2===r?this.expandQuery=e:3===r?this.resourceQuery=e:4===r?this.predicateLabelQuery=e:5===r&&(this.resourcePropertiesQuery=e),this}toSavePayload(){return{id:this.id,name:this.name,startMode:this.startMode,owner:this.owner,startQueryIncludeInferred:this.startQueryIncludeInferred,startQuerySameAs:this.startQuerySameAs,startGraphQuery:this.startGraphQuery,startIRI:this.startIRI,startIRILabel:this.startIRILabel,expandQuery:this.expandQuery,resourceQuery:this.resourceQuery,predicateLabelQuery:this.predicateLabelQuery,resourcePropertiesQuery:this.resourcePropertiesQuery,shared:this.shared,description:this.description,hint:this.hint}}get id(){return this._id}set id(e){this._id=e}get name(){return this._name}set name(e){this._name=e}get startMode(){return this._startMode}set startMode(e){this._startMode=e}get owner(){return this._owner}set owner(e){this._owner=e}get startQueryIncludeInferred(){return this._startQueryIncludeInferred}set startQueryIncludeInferred(e){this._startQueryIncludeInferred=e}get startQuerySameAs(){return this._startQuerySameAs}set startQuerySameAs(e){this._startQuerySameAs=e}get startGraphQuery(){return this._startGraphQuery}set startGraphQuery(e){this._startGraphQuery=e}get startIRI(){return this._startIRI}set startIRI(e){this._startIRI=e}get startIRILabel(){return this._startIRILabel}set startIRILabel(e){this._startIRILabel=e}get expandQuery(){return this._expandQuery}set expandQuery(e){this._expandQuery=e}get resourceQuery(){return this._resourceQuery}set resourceQuery(e){this._resourceQuery=e}get predicateLabelQuery(){return this._predicateLabelQuery}set predicateLabelQuery(e){this._predicateLabelQuery=e}get resourcePropertiesQuery(){return this._resourcePropertiesQuery}set resourcePropertiesQuery(e){this._resourcePropertiesQuery=e}get shared(){return this._shared}set shared(e){this._shared=e}get description(){return this._description}set description(e){this._description=e}get hint(){return this._hint}set hint(e){this._hint=e}get startGraphQueryDescription(){return this._startGraphQueryDescription}set startGraphQueryDescription(e){this._startGraphQueryDescription=e}get expandQueryDescription(){return this._expandQueryDescription}set expandQueryDescription(e){this._expandQueryDescription=e}get resourceQueryDescription(){return this._resourceQueryDescription}set resourceQueryDescription(e){this._resourceQueryDescription=e}get predicateLabelQueryDescription(){return this._predicateLabelQueryDescription}set predicateLabelQueryDescription(e){this._predicateLabelQueryDescription=e}get resourcePropertiesQueryDescription(){return this._resourcePropertiesQueryDescription}set resourcePropertiesQueryDescription(e){this._resourcePropertiesQueryDescription=e}}},91:function(e,r,t){"use strict";t.r(r),t.d(r,"mapGraphsConfigResponseToModel",(function(){return a})),t.d(r,"mapGraphConfigSampleToGraphConfig",(function(){return i})),t.d(r,"mapGraphConfigSamplesToGraphConfigs",(function(){return n}));var s=t(76);const a=e=>new s.GraphsConfig(e.id,e.name,e.startMode,e.owner,e.startQueryIncludeInferred,e.startQuerySameAs,e.startGraphQuery,e.startIRI,e.startIRILabel,e.expandQuery,e.resourceQuery,e.predicateLabelQuery,e.resourcePropertiesQuery,e.shared,e.description,e.hint),i=e=>new s.GraphsConfig(e.id,e.name,e.startMode,e.owner,e.startQueryIncludeInferred,e.startQuerySameAs,e.startGraphQuery,e.startIRI,e.startIRILabel,e.expandQuery,e.resourceQuery,e.predicateLabelQuery,e.resourcePropertiesQuery,e.shared,e.description,e.hint,e.startGraphQueryDescription,e.expandQueryDescription,e.resourceQueryDescription,e.predicateLabelQueryDescription,e.resourcePropertiesQueryDescription),n=e=>e.map(e=>i(e))}}]);