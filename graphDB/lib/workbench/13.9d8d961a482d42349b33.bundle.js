(window.webpackJsonp=window.webpackJsonp||[]).push([[13,145,149],{104:function(e,t,s){"use strict";s.r(t),s.d(t,"ImportResourceTreeElement",(function(){return i}));var r=s(68),o=s(27);class i{constructor(){this.importResource=void 0,this.parent=void 0,this.partialSelected=!1,this.indent=0,this.isImportable=!1,this.hasOngoingImport=!1,this.hasStatusInfo=!1,this.canResetStatus=!1,this.name="",this.shortenedName="",this.path="",this.shortenedContext="",this.selected=!1,this.directories=[],this.files=[],this.isImportedBiggerThanModified=!1,this.isModifiedBiggerThanImported=!1,this.isEditable=!1,this.iconClass="",this.shortenedMessage=""}addResource(e){if(e.isFile())this.files.push(e);else{if(!e.isDirectory())throw new Error("Unsupported resource type!");this.directories.push(e)}}removeResource(e){e.isFile()?this.files=this.files.filter(t=>e.importResource.name!==t.importResource.name):this.directories=this.directories.filter(t=>e.importResource.name!==t.importResource.name)}remove(){this.isRoot()||this.parent.removeResource(this)}getOrCreateDirectory(e){let t=this.directories.find(t=>t.name===e);return t||(t=new i,t.name=e,this.directories.push(t)),t}getRoot(){return this.isRoot()?this:this.parent.getRoot()}isRoot(){return void 0===this.parent}isDirectory(){return this.importResource.isDirectory()}isFile(){return!this.isRoot()&&this.importResource.isFile()}isEmpty(){return 0===this.directories.length&&0===this.files.length}toList(){const e=[];return this.parent&&e.push(this),this.directories.forEach(t=>{e.push(...t.toList())}),e.push(...this.files),e}setSelection(e,t=!0){this.selected=e,this.files.forEach(t=>t.setSelection(e,!1)),this.directories.forEach(t=>t.setSelection(e,!1)),t&&this.getRoot().updateSelectionState()}updateSelectionState(){if(this.directories.forEach(e=>e.updateSelectionState()),this.parent&&this.isDirectory()){const e=this.hasUnselectedChildren(),t=this.hasSelectedChildren();this.selected=t&&!e,this.partialSelected=t&&e}}hasUnselectedChildren(){return this.files.some(e=>!e.selected)||this.directories.some(e=>!e.selected||e.hasUnselectedChildren())}hasSelectedChildren(){return this.files.some(e=>e.selected)||this.directories.some(e=>e.selected||e.hasSelectedChildren())}selectAllWithStatus(e){this.importResource&&e.indexOf(this.importResource.status)>-1&&(this.selected=!0),this.files.forEach(t=>t.selectAllWithStatus(e)),this.directories.forEach(t=>t.selectAllWithStatus(e))}getAllSelectedForImport(){const e=[],t=this.isRoot();return!t&&this.selected&&e.push(this),(t||this.isDirectory()&&!this.selected)&&(this.files.forEach(t=>e.push(...t.getAllSelectedForImport())),this.directories.forEach(t=>e.push(...t.getAllSelectedForImport()))),Object(o.cloneDeep)(e)}getAllSelected(){const e=[];return!this.isRoot()&&this.selected&&e.push(this),this.files.forEach(t=>e.push(...t.getAllSelected())),this.directories.forEach(t=>e.push(...t.getAllSelected())),Object(o.cloneDeep)(e)}getSelectedImportedResources(){return this.getAllSelected().some(e=>e.importResource.status===r.ImportResourceStatus.DONE)}deselectAll(){this.files.forEach(e=>e.deselectAll()),this.directories.forEach(e=>e.deselectAll()),this.selected=!1,this.partialSelected=!1}getAllSelectedFiles(){const e=[];return!this.isRoot()&&this.selected&&e.push(this.importResource),this.files.forEach(t=>e.push(...t.getAllSelectedFiles())),this.directories.forEach(t=>e.push(...t.getAllSelectedFiles())),e}getAllSelectedFilesNames(){return this.getAllSelectedFiles().map(e=>e.name)}getResourceByName(e){if(this.importResource&&this.importResource.name===e)return this;const t=this.files.find(t=>t.importResource.name===e);if(t)return t;for(const t of this.directories){const s=t.getResourceByName(e);if(s)return s}return null}hasTextInResourcesName(e){return!!this.importResource.name.toLowerCase().includes(e.toLowerCase())||(!!this.files.some(t=>t.importResource.name.toLowerCase().includes(e.toLowerCase()))||this.directories.some(t=>t.hasTextInDirectoriesName(e)))}hasTextInDirectoriesName(e){return!(!this.isDirectory()||!this.name.toLowerCase().includes(e.toLowerCase()))||this.directories.some(t=>t.hasTextInDirectoriesName(e))}hasTextInFilesName(e){return!(!this.isFile()||!this.name.toLowerCase().includes(e.toLowerCase()))||(!!this.files.some(t=>t.importResource.name.toLowerCase().includes(e.toLowerCase()))||this.directories.some(t=>t.hasTextInFilesName(e)))}sort(e){this.directories.sort(e),this.files.sort(e),this.directories.forEach(t=>t.sort(e))}getSize(){return this.toList().length}}},128:function(e,t){function s(e,t,s,r,o){e.message=o,e.close=()=>{t.dismiss()},e.copyToClipboard=()=>{navigator.clipboard.writeText(e.message).then(()=>{r.success(s.instant("import.help.messages.copied_to_clipboard")),e.close()},e=>{console.error("Could not copy text: ",e)})}}angular.module("graphdb.framework.impex.import.controllers.import-resource-message-dialog",[]).controller("ImportResourceMessageDialogController",s),s.$inject=["$scope","$uibModalInstance","$translate","toastr","message"]},204:function(e,t,s){"use strict";s.r(t);s(128);var r=s(68),o=s(73);function i(e){return{restrict:"E",templateUrl:"js/angular/import/templates/import-resource-message.html",scope:{resource:"="},link:t=>{t.ImportResourceStatus=r.ImportResourceStatus,t.toTitleCase=e=>o.toTitleCase(e),t.showMessage=t=>{e.open({templateUrl:"js/angular/import/templates/import-resource-message-dialog.html",controller:"ImportResourceMessageDialogController",size:"lg",windowClass:"import-resource-message-dialog",backdrop:"static",resolve:{message:function(){return t?t.importResource.message:""}}})}}}}angular.module("graphdb.framework.import.directives.import-resource-message",["graphdb.framework.impex.import.controllers.import-resource-message-dialog"]).directive("importResourceMessage",i),i.$inject=["$uibModal"]},205:function(e,t){function s(e,t){return{restrict:"E",templateUrl:"js/angular/import/templates/import-resource-status-info.html",scope:{resource:"="},link:s=>{const r=[];s.popoverTemplate="resourceStatusInfoTemplate.html",s.popoverIsOpen=!1,s.context=s.resource.importResource.context,s.replaceGraphs=s.resource.importResource.replaceGraphs,s.baseUrl=decodeURIComponent(s.resource.importResource.baseURI),s.forceSerial=s.resource.importResource.forceSerial,s.importedOn=s.resource.importResource.importedOn,s.parserSettings=s.resource.importResource.parserSettings,s.open=()=>{s.closeAllDialogs(),s.popoverIsOpen=!0},s.closeAllDialogs=()=>{e.$broadcast("closePopovers")},s.close=()=>{s.popoverIsOpen=!1};const o=e=>{"Escape"===e.key&&s.$apply(()=>{s.close()})};r.push(s.$on("closePopovers",s.close)),t.on("keydown",o),s.$on("$destroy",()=>{t.off("keydown",o),r.forEach(e=>e())})}}}angular.module("graphdb.framework.import.directives.import-resource-status-info",[]).directive("importResourceStatusInfo",s),s.$inject=["$rootScope","$document"]},206:function(e,t,s){"use strict";s.r(t),s.d(t,"INDENT",(function(){return c})),s.d(t,"serverImportResourceTypeToIconMapping",(function(){return a})),s.d(t,"userImportResourceTypeToIconMapping",(function(){return n})),s.d(t,"ImportResourceTreeService",(function(){return u}));var r=s(77),o=s(104),i=s(68);const c=30,a=new Map;a.set(r.ImportResourceType.DIRECTORY,"icon-folder"),a.set(r.ImportResourceType.FILE,"icon-file");const n=new Map;n.set(r.ImportResourceType.DIRECTORY,"icon-folder"),n.set(r.ImportResourceType.FILE,"icon-upload"),n.set(r.ImportResourceType.URL,"icon-link"),n.set(r.ImportResourceType.TEXT,"icon-sparql");class u{static toImportResourceTree(e,t){const s=new o.ImportResourceTreeElement;return e.forEach(e=>{u.addResourceToTree(s,e,t)}),s}static mergeResourceTree(e,t,s){e.getRoot().toList().forEach(e=>{t.find(t=>t.name===e.importResource.name)||e.remove()}),t.forEach(t=>{const r=e.getResourceByName(t.name);r?r.importResource=t:u.addResourceToTree(e,t,s)})}static addResourceToTree(e,t,s){const r=u.getPath(t);let i;i=t.isDirectory()?r:r.slice(0,r.length-1);const c=u.getOrCreateParent(e,i);if(t.isFile()){const e=new o.ImportResourceTreeElement;return e.parent=c,e.importResource=t,e.path=r.join("/"),e.name=r[r.length-1],c.addResource(e),u.setIcon(e,s),e}return c.importResource=t,c.path=r.join("/"),u.setIcon(c,s),c}static setIcon(e,t){e.iconClass=t?n.get(e.importResource.type):a.get(e.importResource.type)}static getOrCreateParent(e,t){let s=e;return t.forEach(e=>{const t=s.getOrCreateDirectory(e);t.parent=s,s=t}),s}static getPath(e){if(e.isURL())return[e.name];const t=/[/\\]/;return t.test(e.name)?e.name.split(t):[e.name]}static calculateElementIndent(e){e.indent=8+u.getParentsCount(e)*c+"px",e.directories.forEach(e=>u.calculateElementIndent(e)),e.files.forEach(e=>u.calculateElementIndent(e))}static setupAfterTreeInitProperties(e){e.isRoot()||(e.isImportable=u.isImportable(e.importResource),e.hasOngoingImport=u.hasOngoingImport(e.importResource),e.canResetStatus=u.canResetStatus(e.importResource),e.hasStatusInfo="DONE"===e.importResource.status||"ERROR"===e.importResource.status,e.isEditable=e.importResource.isText(),u.setupShortenedMessage(e),u.setupShortenedContext(e),u.setupShortenedName(e),u.setupImportedAndModifiedComparableProperties(e)),e.directories.forEach(e=>u.setupAfterTreeInitProperties(e)),e.files.forEach(e=>u.setupAfterTreeInitProperties(e))}static setupShortenedMessage(e){const t=e.importResource?e.importResource.message:"";t&&t.length>150&&(e.shortenedMessage=t.substring(0,150)+"...")}static setupShortenedContext(e){const t=e.importResource?e.importResource.context:"";t.length>63&&(e.shortenedContext=t.substring(0,30)+"..."+t.substring(t.length-30))}static setupShortenedName(e){const t=e.name||"";t.length>123&&(e.shortenedName=t.substring(0,30)+"..."+t.substring(t.length-30))}static setupImportedAndModifiedComparableProperties(e){const t=e.importResource;if(t){if(0===t.importedOn||0===t.modifiedOn||t.importedOn===t.modifiedOn)return;e.isImportedBiggerThanModified=t.importedOn>t.modifiedOn,e.isModifiedBiggerThanImported=!e.isImportedBiggerThanModified}}static isImportable(e){return e.status!==i.ImportResourceStatus.IMPORTING&&e.status!==i.ImportResourceStatus.UPLOADING&&e.status!==i.ImportResourceStatus.PENDING&&e.status!==i.ImportResourceStatus.INTERRUPTING&&e.status!==i.ImportResourceStatus.UPLOADING&&e.status!==i.ImportResourceStatus.UPLOADED&&e.status!==i.ImportResourceStatus.UPLOAD_ERROR}static hasOngoingImport(e){return e.status===i.ImportResourceStatus.IMPORTING||e.status===i.ImportResourceStatus.UPLOADING||e.status===i.ImportResourceStatus.PENDING||e.status===i.ImportResourceStatus.INTERRUPTING}static canResetStatus(e){return e.status===i.ImportResourceStatus.DONE||e.status===i.ImportResourceStatus.ERROR}static getParentsCount(e){let t=0;if(void 0===e.parent)return t;let s=e.parent;for(;s;)s=s.parent,t++;return t-1}}},243:function(e,t,s){"use strict";s.r(t);var r=s(68),o=(s(204),s(205),s(127)),i=s(104),c=s(78),a=s(206),n=s(19);const u={FILE:"FILE",DIRECTORY:"DIRECTORY",ALL:"ALL"},l={ALL:"ALL",NONE:"NONE",IMPORTED:"IMPORTED",NOT_IMPORTED:"NOT_IMPORTED"};function p(e,t){return{restrict:"E",templateUrl:"js/angular/import/templates/import-resource-tree.html",scope:{columnKeys:"=",showTypeFilter:"=",sortBy:"=",asc:"=",onImport:"&",onImportAll:"&",onReset:"&",onRemove:"&",onStopImport:"&",onEditResource:"&"},link:(s,p,m)=>{s.resources=new i.ImportResourceTreeElement,s.displayResources=[],s.TYPE_FILTER_OPTIONS=u,s.filterByType=u.ALL,s.filterByFileName="",s.STATUS_OPTIONS=l,s.selectedByStatus=void 0,s.areAllDisplayedImportResourcesSelected=!1,s.areAllDisplayedImportResourcesPartialSelected=!1,s.ImportResourceStatus=r.ImportResourceStatus,s.canRemoveResource=angular.isDefined(m.onRemove),s.canResetSelectedResources=!1,s.SORTING_TYPES=o.SortingType,s.sortAsc=!angular.isDefined(m.asc)||s.asc,s.sortedBy=s.sortBy,s.showLoader=t.getShowLoader(),s.hasSelection=!1,s.selectionChanged=e=>{e.setSelection(e.selected),I(),d(),R()},s.selectResourceWithStatus=e=>{s.selectedByStatus=e,s.resources.setSelection(!1),l.ALL===s.selectedByStatus?s.resources.setSelection(!0):l.IMPORTED===s.selectedByStatus?s.resources.selectAllWithStatus([r.ImportResourceStatus.DONE]):l.NOT_IMPORTED===s.selectedByStatus&&s.resources.selectAllWithStatus([r.ImportResourceStatus.IMPORTING,r.ImportResourceStatus.NONE,r.ImportResourceStatus.ERROR,r.ImportResourceStatus.PENDING,r.ImportResourceStatus.INTERRUPTING]),h(),d()},s.filterByTypeChanged=e=>{s.filterByType=e,h()},s.filterByFileNameChanged=e=>{s.filterByFileName=e,D(h,100)},s.onResetStatus=()=>{const e=s.resources.getAllSelected().map(e=>e.path);e.length>0&&s.onReset({resources:e})},s.resetStatus=e=>{s.onReset({resources:[e.path]})},s.onRemoveResources=()=>{const e=s.resources.getAllSelected();e&&e.length>0&&s.onRemove({resources:e})},s.removeResource=e=>{s.onRemove({resources:[e]})},s.importAll=e=>{const t=s.resources.getAllSelectedForImport();t.length>0&&s.onImportAll({selectedResources:t,withoutChangingSettings:e})},s.stopImport=e=>{s.onStopImport({resource:e})},s.sort=e=>{s.sortedBy===e?s.sortAsc=!s.sortAsc:s.sortAsc=!0,s.sortedBy=e,h()},s.editResource=e=>{s.onEditResource({resource:e})};const d=()=>{s.canResetSelectedResources=s.resources.getSelectedImportedResources()},h=()=>{s.resources.getRoot().updateSelectionState(),g(),s.displayResources=s.resources.toList().filter(A).filter(O),R(),I()},R=()=>{const e=s.resources.getAllSelectedFilesNames();s.hasSelection=e.length>0,t.updateSelectedFilesNames(e)},I=()=>{const e=s.displayResources.some(e=>!e.selected),t=s.displayResources.some(e=>e.selected);s.areAllDisplayedImportResourcesSelected=t&&!e,s.areAllDisplayedImportResourcesPartialSelected=t&&e},g=()=>{o.SortingType.NAME===s.sortedBy?s.resources.sort(f(s.sortAsc)):o.SortingType.SIZE===s.sortedBy?s.resources.sort(S(s.sortAsc)):o.SortingType.MODIFIED===s.sortedBy?s.resources.sort(T(s.sortAsc)):o.SortingType.IMPORTED===s.sortedBy?s.resources.sort(E(s.sortAsc)):o.SortingType.CONTEXT===s.sortedBy&&s.resources.sort(y(s.sortAsc))},f=e=>(t,s)=>e?t.importResource.name.localeCompare(s.importResource.name):s.importResource.name.localeCompare(t.importResource.name),S=e=>(t,s)=>{const r=Object(n.convertToBytes)(t.importResource.size),o=Object(n.convertToBytes)(s.importResource.size);return e?r-o:o-r},T=e=>(t,s)=>{const r=t.importResource.modifiedOn||Number.MAX_VALUE,o=s.importResource.modifiedOn||Number.MAX_VALUE;return e?r-o:o-r},E=e=>(t,s)=>{const r=t.importResource.importedOn||Number.MAX_VALUE,o=s.importResource.importedOn||Number.MAX_VALUE;return e?r-o:o-r},y=e=>(t,s)=>e?t.importResource.context.localeCompare(s.importResource.context):s.importResource.context.localeCompare(t.importResource.context),A=e=>u.ALL===s.filterByType||(s.filterByType===u.FILE?e.isFile():s.filterByType===u.DIRECTORY&&e.isDirectory()),O=e=>!s.filterByFileName||(s.filterByType===u.DIRECTORY?e.hasTextInDirectoriesName(s.filterByFileName):s.filterByType===u.FILE?e.hasTextInFilesName(s.filterByFileName):e.hasTextInResourcesName(s.filterByFileName));let N;const D=(t,s)=>{N&&e.cancel(N),N=e(t,s)},C=[];C.push(t.onResourcesUpdated((e=[])=>{const r=c.TABS.USER===t.getActiveTabId();s.resources.isEmpty()?(s.resources=a.ImportResourceTreeService.toImportResourceTree(e,r),r&&(s.sortedBy=o.SortingType.MODIFIED)):a.ImportResourceTreeService.mergeResourceTree(s.resources,e,r),a.ImportResourceTreeService.calculateElementIndent(s.resources),a.ImportResourceTreeService.setupAfterTreeInitProperties(s.resources),h(),d()})),C.push(t.onShowLoaderUpdated(e=>s.showLoader=e)),C.push(t.onActiveTabIdUpdated(()=>s.resources=new i.ImportResourceTreeElement));s.$on("$destroy",()=>{C.forEach(e=>e())})}}}angular.module("graphdb.framework.import.directives.import-resource-tree",["graphdb.framework.import.directives.import-resource-message","graphdb.framework.import.directives.import-resource-status-info"]).directive("importResourceTree",p),p.$inject=["$timeout","ImportContextService"]}}]);