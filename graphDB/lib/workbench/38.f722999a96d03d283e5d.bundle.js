(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{157:function(e,t,n){"use strict";n.r(t);n(10),n(158);var o=n(87),r=n(27),a=n(82);let s=240;const i={no_cluster_configured:"",create_cluster_btn:"",legend_node_state:"",legend_link_state:"",node_state_leader:"Leader",node_state_follower:"Follower",node_state_candidate:"Candidate",node_state_no_cluster:"No cluster",node_state_out_of_sync:"Out of sync",node_state_no_connection:"No connection",node_state_read_only:"Read only",node_state_restricted:"Restricted",link_state_in_sync:"In sync",link_state_syncing:"Syncing",link_state_out_of_sync:"Out of sync",recovery_state:{searching_for_node:"Searching for node",waiting_for_snapshot:"Waiting for snapshot from node",receiving_snapshot:"Receiving a snapshot from node",applying_snapshot:"Applying a snapshot",building_snapshot:"Building a snapshot for node",sending_snapshot:"Sending a snapshot to node",recovery_operation_failure_warning:"Node unable to recover. Action required"}},c={node_state:"legend_node_state",link_state:"legend_link_state"};angular.module("graphdb.framework.clustermanagement.directives.cluster-graphical-view",["graphdb.framework.utils.localstorageadapter","graphdb.framework.clustermanagement.directives.cluster-legend"]).directive("clusterGraphicalView",["$window","LocalStorageAdapter","LSKeys","UriUtils","$translate","$jwtAuth","$rootScope","ClusterViewContextService",function(e,t,n,l,u,d,f,g){return{restrict:"E",scope:{clusterModel:"="},link:function(p,h){const m=angular.element(e),_=[];let w,C,y,v,E,k=D(),b=O(),A=Math.min(k,b)/2-100,S=k/2,M=b/2;function N(){const e=g.getClusterViewD3Container();k=D(),b=O(),e.attr("width",k),e.attr("height",b),U()}function L(e,t=""){Object.keys(e).forEach(n=>{let o="";t&&(o+=t),o+="."+n;const r=e[n];"string"==typeof r?e[n]=u.instant("cluster_management.cluster_graphical_view"+o):"object"==typeof r&&L(r,o)})}function D(){const o="collapsedMenu"===t.get(n.MENU_STATE);return s=o?70:240,Math.max(Math.floor(.95*(e.innerWidth-s)),600)}function O(){return Math.max(.95*(e.innerHeight-250),675)}function j(){o.updateClusterZoneLabels(C,y,i),Object.keys(c).forEach(e=>{d3.select("#"+e).text(function(e){return i[c[e]]}(e))})}function T(){A=Math.min(k,b)/2-100,S=k/2,M=b/2,o.moveElement(y,S,M),y.select(".cluster-zone").attr("r",A)}function R(e){p.$emit(a.CLICK_IN_VIEW,e.target)}function U(){T(),C!==p.clusterModel.hasCluster&&(C=!!p.clusterModel.hasCluster,function(e){o.setCreateClusterZone(e,y,i,w),!e&&w&&y.on("mouseup",()=>{p.$emit(a.CREATE_CLUSTER)})}(C));const e=function(){const e=Object(r.cloneDeep)(p.clusterModel.nodes)||[];return e.forEach(e=>{if(e.hostname=l.shortenIri(e.endpoint),!Object(r.isEmpty)(e.recoveryStatus)){let t="cluster_management.cluster_graphical_view.recovery_state."+e.recoveryStatus.state.toLowerCase();e.recoveryStatus.affectedNodes&&e.recoveryStatus.affectedNodes.length>0&&(t+="_with_affected_node"),e.recoveryStatus.message=u.instant(t,{node:e.recoveryStatus.affectedNodes.join(", ")})}}),e}();!function(e){const t=v.selectAll("#node-group").data(e,e=>e.address),n=o.createNodes(t,45);n.on("click",(e,t)=>{p.$emit(a.NODE_SELECTED,t);const n=d3.select(".nodetooltip"),o=$(window).width();e.pageX<o/2?(n.style("left",e.pageX+"px"),n.style("right","")):(n.style("left",""),n.style("right",o-e.pageX+"px")),n.style("top",e.pageY-28+"px")}),o.updateNodes(n),o.positionNodesOnClusterZone(n,S,M,A)}(e);!function(e,t){const n=E.selectAll(".link").data(e,e=>e.id);o.createLinks(n),o.updateLinks(n,t)}(Object(r.cloneDeep)(p.clusterModel.links)||[],e)}p.width=function(){return k},p.height=function(){return b};p.$on("$destroy",(function(){m.unbind("resize",N),m.unbind("mousedown",R),o.removeEventListeners(),_.forEach(e=>e())})),w=d.isAdmin(),m.bind("resize",N),m.bind("mousedown",R),_.push(f.$on("$translateChangeSuccess",(function(){L(i),j()}))),_.push(p.$on(a.MODEL_UPDATED,(function(){U()}))),L(i),function(e){const t=o.createClusterSvgElement(h[0]).attr("width",k).attr("height",b);y=o.createClusterZone(t,e),E=t.append("g").attr("id","links-group"),v=t.append("g").attr("id","nodes-group"),o.addArrowHead(t,o.ARROW_CONFIG.BIG),o.addArrowHead(t,o.ARROW_CONFIG.SMALL),g.updateClusterViewD3Container(t)}(!(!p.clusterModel.nodes||!p.clusterModel.nodes.length)),U()}}}])},160:function(e,t,n){"use strict";n.r(t);var o=n(82);function r(e,t,n,r,a){return{restrict:"E",templateUrl:"js/angular/clustermanagement/templates/cluster-configuration.html",scope:{currentNode:"=",clusterModel:"=",clusterConfiguration:"="},link:n=>{n.isAdmin=!1,n.closeClusterConfigurationPanel=()=>{a.hideClusterConfigurationPanel()},n.showEditConfigurationDialog=()=>{t.open({templateUrl:"js/angular/clustermanagement/templates/modal/cluster-edit-dialog.html",controller:"EditClusterCtrl",size:"lg",resolve:{data:()=>({clusterConfiguration:n.clusterConfiguration})}}).result.finally((function(){n.$emit(o.UPDATE_CLUSTER,{force:!0})}))},n.showDeleteDialog=()=>{t.open({templateUrl:"js/angular/clustermanagement/templates/modal/cluster-delete-dialog.html",controller:"DeleteClusterCtrl"}).result.then(e=>{n.$emit(o.DELETE_CLUSTER,{force:e})})};n.isAdmin=e.isAuthenticated()&&e.isAdmin()}}}angular.module("graphdb.framework.clustermanagement.directives.cluster-configuration",[]).directive("clusterConfiguration",r),r.$inject=["$jwtAuth","$uibModal","$translate","toastr","ClusterViewContextService"]},257:function(e,t,n){"use strict";n.r(t);n(7),n(28),n(241),n(157),n(160),n(29),n(446),n(239);angular.module("graphdb.framework.clustermanagement",["ngAnimate","toastr","graphdb.framework.clustermanagement.controllers.cluster-management","graphdb.framework.clustermanagement.directives.cluster-graphical-view","graphdb.framework.clustermanagement.directives.cluster-configuration"])},446:function(e,t,n){var o,r;o=[n(454)],void 0===(r=function(){function e(e,t){return e.each((function(){var e=t.apply(this,arguments),n=select(this);for(var o in e)n.attr(o,e[o])}))}function t(e,t){for(var n in t)e.attr(n,t[n]);return e}return"undefined"==typeof d3&&(d3=n(454)),d3.selection.prototype.attrs=function(n){return("function"==typeof n?e:t)(this,n)},d3.selection.prototype.moveToFront=function(){return this.each((function(){d3.select(this.parentNode.appendChild(this))}))},d3.selection.prototype.moveToBack=function(){return this.each((function(){const e=this.parentNode.firstChild;e&&this.parentNode.insertBefore(this,e)}))},d3}.apply(t,o))||(e.exports=r)}}]);